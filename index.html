<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mySBSI - Federasi Bitung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700;900&display=swap');
        body { font-family: 'Public Sans', sans-serif; background: #002D57; margin: 0; overflow: hidden; }
        .page { display: none; position: absolute; inset: 0; background: #F3F4F6; flex-direction: column; }
        .active { display: flex !important; }
        .bca-blue { background: #002D57; }
        .btn-orange { background: #D97706; color: white; padding: 16px; border-radius: 12px; font-weight: 800; width: 100%; text-transform: uppercase; }
        #splash { position: fixed; inset: 0; background: #FFF; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .card-upah { background: white; margin-bottom: 8px; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input.upah-field { text-align: right; font-weight: 800; color: #002D57; border: none; outline: none; width: 50%; background: transparent; }
    </style>
</head>
<body>

    <div id="splash">
        <img src="Logo_SBSI.png" class="w-32">
        <p class="mt-4 font-black text-gray-400 text-xs tracking-widest">FEDERASI SBSI BITUNG</p>
    </div>

    <div id="page-login" class="page active !bg-[#002D57] items-center justify-center p-10">
        <div class="w-full max-w-sm text-center">
            <img src="Logo My SBSI.png" class="w-64 mx-auto mb-10">
            <div class="space-y-3">
                <input type="text" id="nik" placeholder="NIK Anggota" class="w-full p-4 rounded-xl border-none font-bold">
                <input type="password" id="pass" placeholder="Password" class="w-full p-4 rounded-xl border-none font-bold">
                <button onclick="doLogin()" id="btn-login" class="w-full p-4 bg-[#00AEEF] text-white rounded-xl font-black">MASUK</button>
            </div>
        </div>
    </div>

    <div id="page-wizard" class="page">
        <div class="bca-blue p-4 text-white flex items-center gap-4">
            <button onclick="navigasi('page-dash')">‚Üê</button>
            <h2 id="wiz-title" class="font-black italic text-sm text-orange-400 tracking-tighter">Riwayat Upah Tahun 2021</h2>
        </div>
        <div class="scroll-v p-4 flex-1 overflow-y-auto" id="list-upah">
            </div>
        <div class="p-4 bg-white border-t space-y-2">
            <button onclick="duplikatGaji()" class="w-full py-2 text-[10px] font-bold text-blue-800 bg-blue-50 rounded-lg uppercase">Duplikat Gaji Terakhir</button>
            <button id="btn-next" onclick="prosesNextYear()" class="btn-orange">Simpan & Lanjut ke 2022</button>
        </div>
    </div>

    <div id="page-ump" class="page items-center justify-center p-8 text-center">
        <div class="card bg-white p-8 rounded-[40px] shadow-2xl w-full">
            <div class="text-4xl mb-4">üè¢</div>
            <h3 class="font-black text-blue-900 text-sm uppercase mb-1">Patokan UMP Saat PHK</h3>
            <p id="ump-year-label" class="text-[10px] text-gray-400 font-bold mb-6">Tahun 2025</p>
            <div id="ump-value" class="text-3xl font-black text-blue-900 mb-8">Rp 0</div>
            <button onclick="navigasi('page-hasil-akhir')" class="w-full py-4 bg-green-600 text-white rounded-2xl font-black uppercase">Lihat Hasil Perhitungan</button>
        </div>
    </div>

    <script>
        const URL_GAS = "https://script.google.com/macros/s/AKfycbxIA5NjEr5vYM588QRSFa4nq0cYgU41fthaaXFpwebR-cP23aUZLhoCGjpF6e739cD2/exec";
        let user = null, dbUmp = {}, currentYear = 2021, targetYear = 2025;

        window.onload = () => { setTimeout(() => document.getElementById('splash').style.opacity='0', 2500); setTimeout(() => document.getElementById('splash').style.display='none', 3000); };

        async function doLogin() {
            const n = document.getElementById('nik').value, p = document.getElementById('pass').value;
            const res = await fetch(`${URL_GAS}?action=login&nik=${n}&pass=${p}`).then(r => r.json());
            if(res.status === "success") {
                user = res.user;
                const init = await fetch(`${URL_GAS}?action=getInitData&nik=${user.nik}`).then(r => r.json());
                dbUmp = init.ump;
                startWizard();
            } else alert(res.message);
        }

        function startWizard() {
            currentYear = 2021; // Contoh start
            renderUpah();
            navigasi('page-wizard');
        }

        function renderUpah() {
            document.getElementById('wiz-title').innerText = `Riwayat Upah Tahun ${currentYear}`;
            const months = ["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];
            let html = "";
            months.forEach((m, i) => {
                html += `<div class="card-upah">
                    <span class="text-[10px] font-black text-gray-400">${m}</span>
                    <input type="text" class="upah-field" placeholder="Rp 0" oninput="formatRupiah(this)">
                </div>`;
            });
            document.getElementById('list-upah').innerHTML = html;
            document.getElementById('btn-next').innerText = currentYear === targetYear ? "Selesai & Hitung" : `Simpan & Lanjut ke ${currentYear+1}`;
        }

        function formatRupiah(el) {
            let v = el.value.replace(/[^0-9]/g, '');
            el.value = v ? "Rp " + new Intl.NumberFormat('id-ID').format(v) : "";
        }

        async function prosesNextYear() {
            // Logika simpan data ke sheet Input_Upah_Detail bisa ditambahkan di sini via fetch
            if(currentYear < targetYear) {
                currentYear++;
                renderUpah();
            } else {
                showUmpResult();
            }
        }

        function showUmpResult() {
            const valUmp = dbUmp[targetYear] || 0;
            document.getElementById('ump-year-label').innerText = `TAHUN ${targetYear}`;
            document.getElementById('ump-value').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(valUmp);
            navigasi('page-ump');
        }

        function navigasi(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
