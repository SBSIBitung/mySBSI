<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mySBSI - Kalkulator Hak Buruh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        .bg-mysbsi { background-color: #003366; }
        body, html { margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden; background: #f8fafc; font-family: sans-serif; }
        .page { display: none; position: absolute; inset: 0; width: 100%; height: 100%; flex-direction: column; background: #f8fafc; z-index: 10; }
        .active { display: flex !important; z-index: 50; }
        .scrollable { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        #splash { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card-premium { background: white; border-radius: 30px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .btn-main { background: #003366; color: white; border-radius: 20px; font-weight: bold; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main:active { scale: 0.95; opacity: 0.9; }
        @media print { .no-print { display: none !important; } .page { display: block !important; position: static; height: auto; overflow: visible; } }
    </style>
</head>
<body>

    <div id="splash">
        <img src="Logo_SBSI.png" class="w-32 animate__animated animate__zoomIn">
        <h1 class="mt-4 text-2xl font-black text-blue-900 tracking-tighter">mySBSI BITUNG</h1>
    </div>

    <div id="page-login" class="page items-center justify-center p-6">
        <img src="Logo My SBSI.png" class="w-40 mb-8">
        <div class="card-premium p-8 w-full max-w-sm">
            <h2 class="text-center font-bold text-blue-900 mb-6 uppercase text-xs tracking-widest">Login Anggota</h2>
            <input type="text" id="nik" placeholder="NIK" class="w-full p-4 mb-4 border rounded-2xl outline-none bg-gray-50 text-sm">
            <input type="password" id="pass" placeholder="Password" class="w-full p-4 mb-6 border rounded-2xl outline-none bg-gray-50 text-sm">
            <button onclick="prosesLogin()" id="btn-login" class="w-full btn-main p-4 shadow-lg shadow-blue-900/20">MASUK</button>
        </div>
    </div>

    <div id="page-dashboard" class="page">
        <nav class="bg-mysbsi p-5 text-white flex justify-between items-center">
            <span class="font-bold text-sm uppercase italic">VIVA BURUH!</span>
            <button onclick="logout()" class="text-[10px] bg-red-600 px-4 py-2 rounded-full font-bold">LOGOUT</button>
        </nav>
        <div class="p-6">
            <div class="card-premium p-6 border-l-[12px] border-orange-500 mb-8">
                <h3 id="user-nama" class="font-black text-blue-900 text-xl leading-none">-</h3>
                <p id="user-perusahaan" class="text-xs text-gray-500 mt-2 font-bold uppercase tracking-tighter">-</p>
            </div>
            <button onclick="navigasi('page-wiz-1')" class="w-full card-premium p-8 flex flex-col items-center gap-4 active:bg-gray-50">
                <span class="text-5xl">‚öñÔ∏è</span>
                <span class="font-black text-blue-900 tracking-widest uppercase text-sm">Hitung Hak PHK</span>
            </button>
        </div>
    </div>

    <div id="page-wiz-1" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-dashboard')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">Masa Kerja</span>
        </nav>
        <div class="p-6 space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Tanggal Masuk</label>
                <input type="date" id="tgl-masuk" class="w-full p-4 card-premium mt-1 text-sm outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Tanggal PHK</label>
                <input type="date" id="tgl-phk" class="w-full p-4 card-premium mt-1 text-sm outline-none">
            </div>
            <button onclick="lanjutKeUpah()" class="w-full btn-main p-5 mt-4 shadow-xl bg-orange-500">Lanjut Input Upah</button>
        </div>
    </div>

    <div id="page-wiz-2" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-1')" class="mr-4 text-xl">‚Üê</button>
            <span id="label-tahun-jalan" class="font-bold text-sm uppercase tracking-widest">-</span>
        </nav>
        <div class="scrollable p-4 space-y-2" id="container-input-bulan"></div>
        <div class="p-4 bg-white border-t space-y-2">
            <button onclick="duplikatGajiPintar()" class="w-full bg-blue-50 text-blue-900 p-3 rounded-2xl font-bold text-[10px] border border-blue-200 uppercase tracking-widest">Duplikat Gaji Terakhir</button>
            <button onclick="prosesTahunBerikutnya()" id="btn-next-tahun" class="w-full btn-main p-4 shadow-lg shadow-blue-900/10">Simpan & Lanjut</button>
        </div>
    </div>

    <div id="page-wiz-3" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-2')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">THR & Kompensasi Diterima</span>
        </nav>
        <div class="scrollable p-6 space-y-6">
            <div class="bg-blue-50 p-4 rounded-2xl text-[10px] text-blue-900 italic border border-blue-100">
                Input nominal yang <b>SUDAH DIBAYAR</b> oleh perusahaan saat ini.
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">Total THR yang Pernah Diterima</label>
                <input type="text" id="thr-diterima" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-4 card-premium mt-1 text-blue-900 font-bold outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">Total Kompensasi yang Pernah Diterima</label>
                <input type="text" id="komp-diterima" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-4 card-premium mt-1 text-blue-900 font-bold outline-none">
            </div>
            <button onclick="duplikatMinimal()" class="w-full bg-gray-100 text-gray-500 p-2 rounded-xl font-bold text-[10px] uppercase">Set Minimal Rp 0</button>
        </div>
        <div class="p-4 bg-white border-t">
            <button onclick="navigasi('page-wiz-4')" class="w-full btn-main p-4 shadow-lg">Lanjut ke Patokan UMP</button>
        </div>
    </div>

    <div id="page-wiz-4" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-3')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">Patokan UMP Saat PHK</span>
        </nav>
        <div class="p-6 flex flex-col items-center">
            <div class="text-5xl mb-4">üèôÔ∏è</div>
            <h4 class="font-bold text-blue-900 text-center uppercase tracking-tighter mb-4">Input UMP Bitung / Sulut <br>Pada Tahun PHK</h4>
            <input type="text" id="ump-terakhir" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-5 card-premium text-center text-2xl font-black text-blue-900 outline-none border-2 border-orange-200">
            <p class="text-[9px] text-gray-400 mt-4 text-center">UMP ini akan menjadi dasar perhitungan selisih upah dan pesangon minimal sesuai hukum yang berlaku.</p>
        </div>
        <div class="p-4 bg-white border-t mt-auto">
            <button onclick="hitungHasilFinal()" class="w-full btn-main p-5 bg-green-600 shadow-xl shadow-green-900/20">LIHAT HASIL PERHITUNGAN</button>
        </div>
    </div>

    <div id="page-hasil" class="page">
        <nav class="bg-mysbsi p-5 text-white flex justify-between items-center no-print shadow-lg">
            <button onclick="navigasi('page-dashboard')" class="text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase italic">Hasil Perhitungan Hak</span>
            <button onclick="logout()" class="text-xs bg-red-600 px-3 py-1 rounded-full font-bold">LOGOUT</button>
        </nav>
        
        <div class="scrollable p-6 space-y-6">
            <div class="hidden block print:flex flex-col items-center border-b-4 border-double border-blue-900 pb-4 mb-4">
                <h1 class="font-black text-2xl text-blue-900">SBSI KOTA BITUNG</h1>
                <p class="text-xs uppercase font-bold text-gray-500">Rekapitulasi Hak Pesangon & Selisih Upah</p>
            </div>

            <div class="card-premium p-6 text-center bg-gradient-to-br from-blue-900 to-blue-800 text-white shadow-2xl">
                <h4 class="text-[10px] font-bold opacity-60 uppercase tracking-widest">Total Hak Yang Harus Diterima</h4>
                <p id="res-total" class="text-4xl font-black mt-2 text-orange-400">Rp 0</p>
            </div>

            <div class="space-y-4">
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-blue-900">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Estimasi Pesangon</span>
                    <span id="res-pesangon" class="font-black text-blue-900">Rp 0</span>
                </div>
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-orange-500">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Selisih UMP & THR</span>
                    <span id="res-selisih" class="font-black text-orange-700">Rp 0</span>
                </div>
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-green-500">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Patokan UMP Terakhir</span>
                    <span id="res-ump" class="font-bold text-green-700">Rp 0</span>
                </div>
            </div>

            <div class="no-print space-y-3 pt-6">
                <button onclick="window.print()" class="w-full bg-blue-100 text-blue-900 p-4 rounded-2xl font-black uppercase text-xs tracking-widest border-2 border-blue-200">CETAK / PDF</button>
                <button onclick="navigasi('page-dashboard')" class="w-full bg-gray-200 text-gray-600 p-4 rounded-2xl font-bold uppercase text-xs tracking-widest">KEMBALI KE DASHBOARD</button>
            </div>
        </div>
    </div>

    <script>
        /**************************************************************
         * TANDA: MASUKKAN URL WEB APP (GAS) BAPAK DI SINI
         **************************************************************/
        const URL_GAS = "<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mySBSI - Kalkulator Hak Buruh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        .bg-mysbsi { background-color: #003366; }
        body, html { margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden; background: #f8fafc; font-family: sans-serif; }
        .page { display: none; position: absolute; inset: 0; width: 100%; height: 100%; flex-direction: column; background: #f8fafc; z-index: 10; }
        .active { display: flex !important; z-index: 50; }
        .scrollable { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        #splash { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card-premium { background: white; border-radius: 30px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); }
        .btn-main { background: #003366; color: white; border-radius: 20px; font-weight: bold; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-main:active { scale: 0.95; opacity: 0.9; }
        @media print { .no-print { display: none !important; } .page { display: block !important; position: static; height: auto; overflow: visible; } }
    </style>
</head>
<body>

    <div id="splash">
        <img src="Logo_SBSI.png" class="w-32 animate__animated animate__zoomIn">
        <h1 class="mt-4 text-2xl font-black text-blue-900 tracking-tighter">mySBSI BITUNG</h1>
    </div>

    <div id="page-login" class="page items-center justify-center p-6">
        <img src="Logo My SBSI.png" class="w-40 mb-8">
        <div class="card-premium p-8 w-full max-w-sm">
            <h2 class="text-center font-bold text-blue-900 mb-6 uppercase text-xs tracking-widest">Login Anggota</h2>
            <input type="text" id="nik" placeholder="NIK" class="w-full p-4 mb-4 border rounded-2xl outline-none bg-gray-50 text-sm">
            <input type="password" id="pass" placeholder="Password" class="w-full p-4 mb-6 border rounded-2xl outline-none bg-gray-50 text-sm">
            <button onclick="prosesLogin()" id="btn-login" class="w-full btn-main p-4 shadow-lg shadow-blue-900/20">MASUK</button>
        </div>
    </div>

    <div id="page-dashboard" class="page">
        <nav class="bg-mysbsi p-5 text-white flex justify-between items-center">
            <span class="font-bold text-sm uppercase italic">VIVA BURUH!</span>
            <button onclick="logout()" class="text-[10px] bg-red-600 px-4 py-2 rounded-full font-bold">LOGOUT</button>
        </nav>
        <div class="p-6">
            <div class="card-premium p-6 border-l-[12px] border-orange-500 mb-8">
                <h3 id="user-nama" class="font-black text-blue-900 text-xl leading-none">-</h3>
                <p id="user-perusahaan" class="text-xs text-gray-500 mt-2 font-bold uppercase tracking-tighter">-</p>
            </div>
            <button onclick="navigasi('page-wiz-1')" class="w-full card-premium p-8 flex flex-col items-center gap-4 active:bg-gray-50">
                <span class="text-5xl">‚öñÔ∏è</span>
                <span class="font-black text-blue-900 tracking-widest uppercase text-sm">Hitung Hak PHK</span>
            </button>
        </div>
    </div>

    <div id="page-wiz-1" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-dashboard')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">Masa Kerja</span>
        </nav>
        <div class="p-6 space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Tanggal Masuk</label>
                <input type="date" id="tgl-masuk" class="w-full p-4 card-premium mt-1 text-sm outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2 tracking-widest">Tanggal PHK</label>
                <input type="date" id="tgl-phk" class="w-full p-4 card-premium mt-1 text-sm outline-none">
            </div>
            <button onclick="lanjutKeUpah()" class="w-full btn-main p-5 mt-4 shadow-xl bg-orange-500">Lanjut Input Upah</button>
        </div>
    </div>

    <div id="page-wiz-2" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-1')" class="mr-4 text-xl">‚Üê</button>
            <span id="label-tahun-jalan" class="font-bold text-sm uppercase tracking-widest">-</span>
        </nav>
        <div class="scrollable p-4 space-y-2" id="container-input-bulan"></div>
        <div class="p-4 bg-white border-t space-y-2">
            <button onclick="duplikatGajiPintar()" class="w-full bg-blue-50 text-blue-900 p-3 rounded-2xl font-bold text-[10px] border border-blue-200 uppercase tracking-widest">Duplikat Gaji Terakhir</button>
            <button onclick="prosesTahunBerikutnya()" id="btn-next-tahun" class="w-full btn-main p-4 shadow-lg shadow-blue-900/10">Simpan & Lanjut</button>
        </div>
    </div>

    <div id="page-wiz-3" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-2')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">THR & Kompensasi Diterima</span>
        </nav>
        <div class="scrollable p-6 space-y-6">
            <div class="bg-blue-50 p-4 rounded-2xl text-[10px] text-blue-900 italic border border-blue-100">
                Input nominal yang <b>SUDAH DIBAYAR</b> oleh perusahaan saat ini.
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">Total THR yang Pernah Diterima</label>
                <input type="text" id="thr-diterima" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-4 card-premium mt-1 text-blue-900 font-bold outline-none">
            </div>
            <div>
                <label class="text-[10px] font-bold text-gray-400 uppercase ml-2">Total Kompensasi yang Pernah Diterima</label>
                <input type="text" id="komp-diterima" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-4 card-premium mt-1 text-blue-900 font-bold outline-none">
            </div>
            <button onclick="duplikatMinimal()" class="w-full bg-gray-100 text-gray-500 p-2 rounded-xl font-bold text-[10px] uppercase">Set Minimal Rp 0</button>
        </div>
        <div class="p-4 bg-white border-t">
            <button onclick="navigasi('page-wiz-4')" class="w-full btn-main p-4 shadow-lg">Lanjut ke Patokan UMP</button>
        </div>
    </div>

    <div id="page-wiz-4" class="page">
        <nav class="bg-mysbsi p-5 text-white flex items-center shadow-md">
            <button onclick="navigasi('page-wiz-3')" class="mr-4 text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase">Patokan UMP Saat PHK</span>
        </nav>
        <div class="p-6 flex flex-col items-center">
            <div class="text-5xl mb-4">üèôÔ∏è</div>
            <h4 class="font-bold text-blue-900 text-center uppercase tracking-tighter mb-4">Input UMP Bitung / Sulut <br>Pada Tahun PHK</h4>
            <input type="text" id="ump-terakhir" oninput="handleInputRupiahNoID(event)" placeholder="Rp 0" class="w-full p-5 card-premium text-center text-2xl font-black text-blue-900 outline-none border-2 border-orange-200">
            <p class="text-[9px] text-gray-400 mt-4 text-center">UMP ini akan menjadi dasar perhitungan selisih upah dan pesangon minimal sesuai hukum yang berlaku.</p>
        </div>
        <div class="p-4 bg-white border-t mt-auto">
            <button onclick="hitungHasilFinal()" class="w-full btn-main p-5 bg-green-600 shadow-xl shadow-green-900/20">LIHAT HASIL PERHITUNGAN</button>
        </div>
    </div>

    <div id="page-hasil" class="page">
        <nav class="bg-mysbsi p-5 text-white flex justify-between items-center no-print shadow-lg">
            <button onclick="navigasi('page-dashboard')" class="text-xl">‚Üê</button>
            <span class="font-bold text-sm uppercase italic">Hasil Perhitungan Hak</span>
            <button onclick="logout()" class="text-xs bg-red-600 px-3 py-1 rounded-full font-bold">LOGOUT</button>
        </nav>
        
        <div class="scrollable p-6 space-y-6">
            <div class="hidden block print:flex flex-col items-center border-b-4 border-double border-blue-900 pb-4 mb-4">
                <h1 class="font-black text-2xl text-blue-900">SBSI KOTA BITUNG</h1>
                <p class="text-xs uppercase font-bold text-gray-500">Rekapitulasi Hak Pesangon & Selisih Upah</p>
            </div>

            <div class="card-premium p-6 text-center bg-gradient-to-br from-blue-900 to-blue-800 text-white shadow-2xl">
                <h4 class="text-[10px] font-bold opacity-60 uppercase tracking-widest">Total Hak Yang Harus Diterima</h4>
                <p id="res-total" class="text-4xl font-black mt-2 text-orange-400">Rp 0</p>
            </div>

            <div class="space-y-4">
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-blue-900">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Estimasi Pesangon</span>
                    <span id="res-pesangon" class="font-black text-blue-900">Rp 0</span>
                </div>
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-orange-500">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Selisih UMP & THR</span>
                    <span id="res-selisih" class="font-black text-orange-700">Rp 0</span>
                </div>
                <div class="card-premium p-5 flex justify-between items-center border-l-8 border-green-500">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Patokan UMP Terakhir</span>
                    <span id="res-ump" class="font-bold text-green-700">Rp 0</span>
                </div>
            </div>

            <div class="no-print space-y-3 pt-6">
                <button onclick="window.print()" class="w-full bg-blue-100 text-blue-900 p-4 rounded-2xl font-black uppercase text-xs tracking-widest border-2 border-blue-200">CETAK / PDF</button>
                <button onclick="navigasi('page-dashboard')" class="w-full bg-gray-200 text-gray-600 p-4 rounded-2xl font-bold uppercase text-xs tracking-widest">KEMBALI KE DASHBOARD</button>
            </div>
        </div>
    </div>

    <script>
        /**************************************************************
         * TANDA: MASUKKAN URL WEB APP (GAS) BAPAK DI SINI
         **************************************************************/
        const URL_GAS = "MASUKKAN_URL_SCRIPT_GOOGLE_BAPAK_DI_SINI"; 
        /**************************************************************/

        let tahunList = [], indexTahunSekarang = 0, databaseUpah = {}, tglMasuk, tglPhk;

        function navigasi(pageId) {
            document.querySelectorAll('.page').forEach(p => { p.classList.remove('active'); p.style.display = 'none'; });
            const target = document.getElementById(pageId);
            target.style.display = 'flex';
            setTimeout(() => target.classList.add('active'), 10);
        }

        function formatRupiah(angka, prefix) {
            let number_string = angka.replace(/[^,\d]/g, '').toString(),
                split = number_string.split(','),
                sisa = split[0].length % 3,
                rupiah = split[0].substr(0, sisa),
                ribuan = split[0].substr(sisa).match(/\d{3}/gi);
            if (ribuan) { let separator = sisa ? '.' : ''; rupiah += separator + ribuan.join('.'); }
            return prefix == undefined ? rupiah : (rupiah ? 'Rp ' + rupiah : '');
        }

        function handleInputRupiah(e) {
            let val = e.target.value;
            e.target.value = formatRupiah(val, 'Rp ');
            const idBulan = e.target.id.split('-')[1];
            databaseUpah[`${tahunList[indexTahunSekarang]}-${idBulan}`] = val.replace(/[^0-9]/g, '');
        }

        function handleInputRupiahNoID(e) {
            e.target.value = formatRupiah(e.target.value, 'Rp ');
        }

        window.addEventListener('load', () => {
            setTimeout(() => { 
                document.getElementById('splash').style.display='none'; 
                const session = localStorage.getItem("session_sbsi");
                if(session) renderUser(JSON.parse(session)); else navigasi('page-login');
            }, 2500);
        });

        async function prosesLogin() {
            const nik = document.getElementById('nik').value;
            const pass = document.getElementById('pass').value;
            if(!nik || !pass) return alert("Isi NIK & Password!");
            document.getElementById('btn-login').innerText = "MENGECEK...";
            try {
                const res = await fetch(`${URL_GAS}?action=login&nik=${nik}&pass=${pass}`);
                const data = await res.json();
                if(data.status === "success") { 
                    localStorage.setItem("session_sbsi", JSON.stringify(data.user)); 
                    renderUser(data.user); 
                } else { alert(data.message); document.getElementById('btn-login').innerText = "MASUK"; }
            } catch (e) { alert("Cek koneksi/URL GAS!"); document.getElementById('btn-login').innerText = "MASUK"; }
        }

        function renderUser(user) {
            document.getElementById('user-nama').innerText = user.nama;
            document.getElementById('user-perusahaan').innerText = user.perusahaan;
            navigasi('page-dashboard');
        }

        function logout() { if(confirm("Keluar?")) { localStorage.removeItem("session_sbsi"); location.reload(); } }

        function lanjutKeUpah() {
            const m = document.getElementById('tgl-masuk').value;
            const p = document.getElementById('tgl-phk').value;
            if(!m || !p) return alert("Pilih tanggal!");
            tglMasuk = new Date(m); tglPhk = new Date(p);
            tahunList = [];
            for(let t = tglMasuk.getFullYear(); t <= tglPhk.getFullYear(); t++) tahunList.push(t);
            indexTahunSekarang = 0;
            renderFormTahun();
        }

        function renderFormTahun() {
            const thn = tahunList[indexTahunSekarang];
            document.getElementById('label-tahun-jalan').innerText = "UPAH TAHUN " + thn;
            const blnNama = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
            let html = "";
            let mStart = (thn === tglMasuk.getFullYear()) ? tglMasuk.getMonth() : 0;
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;

            for(let i = mStart; i <= mEnd; i++) {
                const key = `${thn}-${i+1}`;
                const rawVal = databaseUpah[key] || "";
                let infoProrata = "";
                if(thn === tglMasuk.getFullYear() && i === mStart && tglMasuk.getDate() > 1) {
                    infoProrata = `<span class="text-[8px] text-orange-500 font-bold italic">Mulai tgl ${tglMasuk.getDate()}</span>`;
                } else if(thn === tglPhk.getFullYear() && i === mEnd && tglPhk.getDate() < 28) {
                    infoProrata = `<span class="text-[8px] text-orange-500 font-bold italic">Sampai tgl ${tglPhk.getDate()}</span>`;
                }
                html += `
                <div class="card-premium p-4 flex items-center justify-between border-gray-50">
                    <div class="leading-none text-left">
                        <p class="text-[10px] font-black text-gray-400 uppercase">${blnNama[i]}</p>
                        ${infoProrata}
                    </div>
                    <input type="text" id="inp-${i+1}" value="${rawVal ? formatRupiah(rawVal,'Rp ') : ''}" 
                           oninput="handleInputRupiah(event)" placeholder="Rp 0" class="w-36 text-right font-black text-blue-900 outline-none bg-transparent">
                </div>`;
            }
            document.getElementById('container-input-bulan').innerHTML = html;
            document.getElementById('btn-next-tahun').innerText = (indexTahunSekarang === tahunList.length - 1) ? "SIMPAN & KE THR" : "LANJUT KE " + (thn+1);
            navigasi('page-wiz-2');
        }

        function duplikatGajiPintar() {
            const thn = tahunList[indexTahunSekarang];
            let gTerakhir = ""; let bTerakhir = 0;
            let mStart = (thn === tglMasuk.getFullYear()) ? tglMasuk.getMonth() : 0;
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;
            for(let i = mStart; i <= mEnd; i++) {
                const val = databaseUpah[`${thn}-${i+1}`];
                if(val > 0) { gTerakhir = val; bTerakhir = i+1; }
            }
            if(bTerakhir === 0) return alert("Isi gaji minimal satu bulan!");
            for(let i = bTerakhir; i <= mEnd; i++) {
                databaseUpah[`${thn}-${i+1}`] = gTerakhir;
                const el = document.getElementById('inp-' + (i+1));
                if(el) el.value = formatRupiah(gTerakhir, 'Rp ');
            }
        }

        function duplikatMinimal() {
            document.getElementById('thr-diterima').value = "Rp 0";
            document.getElementById('komp-diterima').value = "Rp 0";
        }

        function prosesTahunBerikutnya() {
            if(indexTahunSekarang < tahunList.length - 1) { indexTahunSekarang++; renderFormTahun(); }
            else { navigasi('page-wiz-3'); }
        }

        function hitungHasilFinal() {
            const umpRaw = document.getElementById('ump-terakhir').value.replace(/[^0-9]/g, '');
            if(!umpRaw || umpRaw == 0) return alert("Mohon input UMP patokan!");
            
            // Logika Sederhana Simulasi (Akan lebih akurat jika dihitung di server/GAS)
            const ump = parseInt(umpRaw);
            const pesangon = ump * 9; // Contoh 9 bulan upah
            const selisih = 5500000;
            const total = pesangon + selisih;

            document.getElementById('res-pesangon').innerText = formatRupiah(pesangon.toString(), 'Rp ');
            document.getElementById('res-selisih').innerText = formatRupiah(selisih.toString(), 'Rp ');
            document.getElementById('res-ump').innerText = formatRupiah(ump.toString(), 'Rp ');
            document.getElementById('res-total').innerText = formatRupiah(total.toString(), 'Rp ');
            
            navigasi('page-hasil');
        }
    </script>
</body>
</html>"; 
        /**************************************************************/

        let tahunList = [], indexTahunSekarang = 0, databaseUpah = {}, tglMasuk, tglPhk;

        function navigasi(pageId) {
            document.querySelectorAll('.page').forEach(p => { p.classList.remove('active'); p.style.display = 'none'; });
            const target = document.getElementById(pageId);
            target.style.display = 'flex';
            setTimeout(() => target.classList.add('active'), 10);
        }

        function formatRupiah(angka, prefix) {
            let number_string = angka.replace(/[^,\d]/g, '').toString(),
                split = number_string.split(','),
                sisa = split[0].length % 3,
                rupiah = split[0].substr(0, sisa),
                ribuan = split[0].substr(sisa).match(/\d{3}/gi);
            if (ribuan) { let separator = sisa ? '.' : ''; rupiah += separator + ribuan.join('.'); }
            return prefix == undefined ? rupiah : (rupiah ? 'Rp ' + rupiah : '');
        }

        function handleInputRupiah(e) {
            let val = e.target.value;
            e.target.value = formatRupiah(val, 'Rp ');
            const idBulan = e.target.id.split('-')[1];
            databaseUpah[`${tahunList[indexTahunSekarang]}-${idBulan}`] = val.replace(/[^0-9]/g, '');
        }

        function handleInputRupiahNoID(e) {
            e.target.value = formatRupiah(e.target.value, 'Rp ');
        }

        window.addEventListener('load', () => {
            setTimeout(() => { 
                document.getElementById('splash').style.display='none'; 
                const session = localStorage.getItem("session_sbsi");
                if(session) renderUser(JSON.parse(session)); else navigasi('page-login');
            }, 2500);
        });

        async function prosesLogin() {
            const nik = document.getElementById('nik').value;
            const pass = document.getElementById('pass').value;
            if(!nik || !pass) return alert("Isi NIK & Password!");
            document.getElementById('btn-login').innerText = "MENGECEK...";
            try {
                const res = await fetch(`${URL_GAS}?action=login&nik=${nik}&pass=${pass}`);
                const data = await res.json();
                if(data.status === "success") { 
                    localStorage.setItem("session_sbsi", JSON.stringify(data.user)); 
                    renderUser(data.user); 
                } else { alert(data.message); document.getElementById('btn-login').innerText = "MASUK"; }
            } catch (e) { alert("Cek koneksi/URL GAS!"); document.getElementById('btn-login').innerText = "MASUK"; }
        }

        function renderUser(user) {
            document.getElementById('user-nama').innerText = user.nama;
            document.getElementById('user-perusahaan').innerText = user.perusahaan;
            navigasi('page-dashboard');
        }

        function logout() { if(confirm("Keluar?")) { localStorage.removeItem("session_sbsi"); location.reload(); } }

        function lanjutKeUpah() {
            const m = document.getElementById('tgl-masuk').value;
            const p = document.getElementById('tgl-phk').value;
            if(!m || !p) return alert("Pilih tanggal!");
            tglMasuk = new Date(m); tglPhk = new Date(p);
            tahunList = [];
            for(let t = tglMasuk.getFullYear(); t <= tglPhk.getFullYear(); t++) tahunList.push(t);
            indexTahunSekarang = 0;
            renderFormTahun();
        }

        function renderFormTahun() {
            const thn = tahunList[indexTahunSekarang];
            document.getElementById('label-tahun-jalan').innerText = "UPAH TAHUN " + thn;
            const blnNama = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
            let html = "";
            let mStart = (thn === tglMasuk.getFullYear()) ? tglMasuk.getMonth() : 0;
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;

            for(let i = mStart; i <= mEnd; i++) {
                const key = `${thn}-${i+1}`;
                const rawVal = databaseUpah[key] || "";
                let infoProrata = "";
                if(thn === tglMasuk.getFullYear() && i === mStart && tglMasuk.getDate() > 1) {
                    infoProrata = `<span class="text-[8px] text-orange-500 font-bold italic">Mulai tgl ${tglMasuk.getDate()}</span>`;
                } else if(thn === tglPhk.getFullYear() && i === mEnd && tglPhk.getDate() < 28) {
                    infoProrata = `<span class="text-[8px] text-orange-500 font-bold italic">Sampai tgl ${tglPhk.getDate()}</span>`;
                }
                html += `
                <div class="card-premium p-4 flex items-center justify-between border-gray-50">
                    <div class="leading-none text-left">
                        <p class="text-[10px] font-black text-gray-400 uppercase">${blnNama[i]}</p>
                        ${infoProrata}
                    </div>
                    <input type="text" id="inp-${i+1}" value="${rawVal ? formatRupiah(rawVal,'Rp ') : ''}" 
                           oninput="handleInputRupiah(event)" placeholder="Rp 0" class="w-36 text-right font-black text-blue-900 outline-none bg-transparent">
                </div>`;
            }
            document.getElementById('container-input-bulan').innerHTML = html;
            document.getElementById('btn-next-tahun').innerText = (indexTahunSekarang === tahunList.length - 1) ? "SIMPAN & KE THR" : "LANJUT KE " + (thn+1);
            navigasi('page-wiz-2');
        }

        function duplikatGajiPintar() {
            const thn = tahunList[indexTahunSekarang];
            let gTerakhir = ""; let bTerakhir = 0;
            let mStart = (thn === tglMasuk.getFullYear()) ? tglMasuk.getMonth() : 0;
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;
            for(let i = mStart; i <= mEnd; i++) {
                const val = databaseUpah[`${thn}-${i+1}`];
                if(val > 0) { gTerakhir = val; bTerakhir = i+1; }
            }
            if(bTerakhir === 0) return alert("Isi gaji minimal satu bulan!");
            for(let i = bTerakhir; i <= mEnd; i++) {
                databaseUpah[`${thn}-${i+1}`] = gTerakhir;
                const el = document.getElementById('inp-' + (i+1));
                if(el) el.value = formatRupiah(gTerakhir, 'Rp ');
            }
        }

        function duplikatMinimal() {
            document.getElementById('thr-diterima').value = "Rp 0";
            document.getElementById('komp-diterima').value = "Rp 0";
        }

        function prosesTahunBerikutnya() {
            if(indexTahunSekarang < tahunList.length - 1) { indexTahunSekarang++; renderFormTahun(); }
            else { navigasi('page-wiz-3'); }
        }

        function hitungHasilFinal() {
            const umpRaw = document.getElementById('ump-terakhir').value.replace(/[^0-9]/g, '');
            if(!umpRaw || umpRaw == 0) return alert("Mohon input UMP patokan!");
            
            // Logika Sederhana Simulasi (Akan lebih akurat jika dihitung di server/GAS)
            const ump = parseInt(umpRaw);
            const pesangon = ump * 9; // Contoh 9 bulan upah
            const selisih = 5500000;
            const total = pesangon + selisih;

            document.getElementById('res-pesangon').innerText = formatRupiah(pesangon.toString(), 'Rp ');
            document.getElementById('res-selisih').innerText = formatRupiah(selisih.toString(), 'Rp ');
            document.getElementById('res-ump').innerText = formatRupiah(ump.toString(), 'Rp ');
            document.getElementById('res-total').innerText = formatRupiah(total.toString(), 'Rp ');
            
            navigasi('page-hasil');
        }
    </script>
</body>
</html>
