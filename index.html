<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mySBSI - Kalkulator Hak Buruh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700;900&display=swap');
        body { font-family: 'Public Sans', sans-serif; background: #002D57; margin: 0; }
        .page { display: none; min-height: 100vh; flex-direction: column; background: #F3F4F6; }
        .active { display: flex !important; }
        .input-card { background: white; padding: 15px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .input-card span { font-size: 10px; font-weight: 900; color: #6B7280; text-transform: uppercase; }
        .input-card input { text-align: right; font-weight: 900; color: #002D57; border: none; outline: none; width: 40%; font-size: 15px; }
        .btn-next { background: #3D2B2A; color: white; padding: 18px; border-radius: 12px; width: 100%; font-weight: 900; text-transform: uppercase; margin-top: 10px; }
        .logo-login { width: 240px; height: 70px; object-fit: cover; object-position: top; }
    </style>
</head>
<body>

    <div id="page-login" class="page active !bg-[#002D57] items-center justify-center p-10">
        <img src="Logo My SBSI.png" class="logo-login mb-10">
        <div class="w-full max-w-sm space-y-4">
            <input type="text" id="nik" placeholder="NIK Anggota" class="w-full p-4 rounded-xl font-bold outline-none">
            <input type="password" id="pass" placeholder="Password" class="w-full p-4 rounded-xl font-bold outline-none">
            <button onclick="doLogin()" class="w-full p-4 bg-[#00AEEF] text-white rounded-xl font-black shadow-lg">MASUK</button>
        </div>
    </div>

    <div id="page-dates" class="page">
        <div class="bg-[#002D57] p-5 text-white flex items-center gap-3">
            <button onclick="location.reload()">←</button>
            <h2 class="font-black text-sm italic">MASA KERJA</h2>
        </div>
        <div class="p-6 space-y-6 flex-1">
            <div class="bg-white p-6 rounded-3xl shadow-sm">
                <label class="text-[10px] font-black text-gray-400 uppercase block mb-2">Tanggal Masuk</label>
                <input type="date" id="tgl-masuk" class="w-full p-3 bg-gray-50 rounded-xl font-bold outline-none border-2 border-gray-100">
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm">
                <label class="text-[10px] font-black text-gray-400 uppercase block mb-2">Tanggal PHK</label>
                <input type="date" id="tgl-phk" class="w-full p-3 bg-gray-50 rounded-xl font-bold outline-none border-2 border-gray-100">
            </div>
        </div>
        <div class="p-6"><button onclick="generateWizard()" class="btn-next">Lanjut Input Upah</button></div>
    </div>

    <div id="page-gaji" class="page">
        <div class="bg-[#002D57] p-5 text-white flex items-center gap-3 sticky top-0 z-10">
            <button onclick="navigasi('page-dates')">←</button>
            <h2 class="font-black text-sm italic">UPAH HARIAN (X 25)</h2>
        </div>
        <div id="list-gaji" class="flex-1 overflow-y-auto bg-white"></div>
        <div class="p-4 bg-white border-t sticky bottom-0">
            <div onclick="duplikatGaji()" class="text-center text-blue-500 font-black text-[10px] uppercase mb-4 cursor-pointer">Duplikat Nilai Terakhir</div>
            <button onclick="navigasi('page-tambahan')" class="btn-next">Lanjut THR & Kompensasi</button>
        </div>
    </div>

    <div id="page-tambahan" class="page">
        <div class="bg-[#002D57] p-5 text-white flex items-center gap-3">
            <button onclick="navigasi('page-gaji')">←</button>
            <h2 class="font-black text-sm italic">THR & KOMPENSASI (PRORATA)</h2>
        </div>
        <div id="list-tambahan" class="flex-1 overflow-y-auto"></div>
        <div class="p-6"><button onclick="hitungFinal()" class="btn-next">Lihat Hasil & UMP</button></div>
    </div>

    <div id="page-ump" class="page items-center justify-center p-8">
        <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full text-center">
            <h3 class="font-black text-[#002D57] text-sm uppercase">UMP TERAKHIR (PATOKAN)</h3>
            <p id="ump-label" class="text-[10px] text-gray-400 font-bold mb-6">TAHUN -</p>
            <div id="ump-val" class="text-4xl font-black text-[#002D57] mb-8">Rp 0</div>
            <div class="p-4 bg-orange-50 rounded-2xl mb-8">
                <p class="text-[9px] font-black text-orange-600 uppercase">Estimasi Hak Anda (PP 35/2021)</p>
                <p id="total-hak" class="text-xl font-black text-orange-700">Rp 0</p>
            </div>
            <button class="w-full py-5 bg-[#10B981] text-white rounded-2xl font-black uppercase">Cetak Rekapitulasi</button>
        </div>
    </div>

    <script>
        const URL_GAS = "https://script.google.com/macros/s/AKfycbwZtwj9JFD-jEbqEucC9293Us5ftZh85khLp8xegvRCGM_fsoLjmyRdcYuqFs_KJHg/exec";
        let dbUmp = {};

        async function doLogin() {
            // Logika login ke tab User_Data
            const res = await fetch(`${URL_GAS}?action=login&nik=${document.getElementById('nik').value}&pass=${document.getElementById('pass').value}`).then(r => r.json());
            if(res.status === "success") {
                const uRes = await fetch(`${URL_GAS}?action=getUMP`).then(r => r.json());
                dbUmp = uRes.data;
                navigasi('page-dates');
            } else alert("Akses Ditolak!");
        }

        function generateWizard() {
            const start = new Date(document.getElementById('tgl-masuk').value);
            const end = new Date(document.getElementById('tgl-phk').value);
            if(isNaN(start) || isNaN(end)) return alert("Set Tanggal!");

            let htmlGaji = "", htmlTambahan = "";
            let curr = new Date(start.getFullYear(), start.getMonth(), 1);
            let years = new Set();

            while(curr <= end) {
                const label = curr.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
                // Logika Prorata Bulan Pertama
                let pengali = 25;
                if(curr.getMonth() === start.getMonth() && curr.getFullYear() === start.getFullYear()) {
                    let hariBulan = new Date(start.getFullYear(), start.getMonth() + 1, 0).getDate();
                    let hariKerja = hariBulan - start.getDate() + 1;
                    pengali = Math.min(25, hariKerja); 
                }
                
                htmlGaji += `
                <div class="input-card">
                    <div class="flex flex-col">
                        <span>${label}</span>
                        <small class="text-[8px] text-orange-500 font-bold">ESTIMASI: ${pengali} HARI</small>
                    </div>
                    <input type="text" placeholder="Upah/Hari" oninput="fmt(this)" class="inp-hari" data-pengali="${pengali}">
                </div>`;
                years.add(curr.getFullYear());
                curr.setMonth(curr.getMonth() + 1);
            }

            years.forEach(y => {
                htmlTambahan += `
                <div class="p-4 font-black text-[11px] text-blue-900 bg-gray-200 uppercase italic">TAHUN ${y}</div>
                <div class="input-card"><span>THR (PRORATA)</span><input type="text" placeholder="Rp 0" oninput="fmt(this)"></div>
                <div class="input-card"><span>KOMPENSASI</span><input type="text" placeholder="Rp 0" oninput="fmt(this)"></div>`;
            });

            document.getElementById('list-gaji').innerHTML = htmlGaji;
            document.getElementById('list-tambahan').innerHTML = htmlTambahan;
            navigasi('page-gaji');
        }

        function hitungFinal() {
            const tgl = new Date(document.getElementById('tgl-phk').value);
            const thn = tgl.getFullYear();
            const ump = dbUmp[thn] || 0;
            
            document.getElementById('ump-label').innerText = `TAHUN ${thn}`;
            document.getElementById('ump-val').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(ump);
            navigasi('page-ump');
        }

        function fmt(el) {
            let v = el.value.replace(/[^0-9]/g, '');
            el.value = v ? "Rp " + new Intl.NumberFormat('id-ID').format(v) : "";
        }

        function duplikatGaji() {
            const inps = document.querySelectorAll('.inp-hari');
            let val = "";
            inps.forEach(i => { if(i.value) val = i.value; });
            if(val) inps.forEach(i => i.value = val);
        }

        function navigasi(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
