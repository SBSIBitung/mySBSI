<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mySBSI Premium v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        :root { --primary: #003366; --accent: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; overflow: hidden; }
        .page { display: none; position: absolute; inset: 0; flex-direction: column; background: #f1f5f9; }
        .active { display: flex !important; animation: fadeIn 0.3s ease-in-out; }
        .glass-card { background: white; border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.2); }
        .input-premium { width: 100%; padding: 1rem; border-radius: 16px; border: 1px solid #e2e8f0; outline: none; transition: all 0.2s; }
        .input-premium:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0,51,102,0.1); }
        .btn-primary { background: var(--primary); color: white; padding: 1rem; border-radius: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-primary:active { transform: scale(0.98); }
        .scroll-area { flex: 1; overflow-y: auto; padding: 1.5rem; -webkit-overflow-scrolling: touch; }
        @media print { .no-print { display: none !important; } .page { display: block !important; position: static; background: white; } .print-only { display: block !important; } }
    </style>
</head>
<body>

    <div id="custom-alert" class="hidden fixed top-5 left-1/2 -translate-x-1/2 z-[1000] w-[90%] max-w-sm p-4 rounded-2xl bg-white shadow-2xl border-l-4 border-blue-900 animate__animated animate__fadeInDown">
        <p id="alert-msg" class="text-sm font-bold text-blue-900"></p>
    </div>

    <div id="page-login" class="page active items-center justify-center p-6">
        <div class="glass-card p-8 w-full max-w-sm text-center">
            <h1 class="text-3xl font-extrabold text-blue-900 mb-2 italic">mySBSI</h1>
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-[3px] mb-8">Advokasi Digital Bitung</p>
            <div class="space-y-4">
                <input type="text" id="nik" placeholder="NIK" class="input-premium">
                <input type="password" id="pass" placeholder="Password" class="input-premium">
                <button onclick="prosesLogin()" class="w-full btn-primary shadow-lg shadow-blue-900/30">Masuk Aplikasi</button>
            </div>
        </div>
    </div>

    <div id="page-dashboard" class="page">
        <div class="p-6 bg-blue-900 text-white flex justify-between items-center rounded-b-[40px] shadow-lg">
            <div>
                <p class="text-[10px] opacity-60 font-bold uppercase tracking-widest">Selamat Datang,</p>
                <h2 id="user-nama" class="text-xl font-black">Anggota SBSI</h2>
            </div>
            <button onclick="logout()" class="p-2 bg-red-500/20 rounded-xl text-red-200 text-[10px] font-bold border border-red-500/30">LOGOUT</button>
        </div>
        <div class="p-6">
            <button onclick="navigasi('page-wiz-1')" class="w-full glass-card p-10 flex flex-col items-center gap-4 active:bg-gray-50 border-b-8 border-orange-500">
                <div class="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center text-4xl text-orange-600">‚öñÔ∏è</div>
                <div class="text-center">
                    <h3 class="font-black text-blue-900 uppercase">Hitung Pesangon</h3>
                    <p class="text-[10px] text-gray-400 font-bold italic">Sesuai PP 35 Tahun 2021</p>
                </div>
            </button>
        </div>
    </div>

    <div id="page-wiz-1" class="page">
        <div class="p-6 flex items-center gap-4">
            <button onclick="navigasi('page-dashboard')" class="w-10 h-10 glass-card flex items-center justify-center">‚Üê</button>
            <h2 class="font-black text-blue-900 uppercase tracking-tighter">Masa Kerja</h2>
        </div>
        <div class="p-6 space-y-6">
            <div>
                <label class="text-[10px] font-black text-gray-400 uppercase ml-2 mb-2 block">Tanggal Masuk Kerja</label>
                <input type="date" id="tgl-masuk" class="input-premium">
            </div>
            <div>
                <label class="text-[10px] font-black text-gray-400 uppercase ml-2 mb-2 block">Tanggal PHK / Keluar</label>
                <input type="date" id="tgl-phk" class="input-premium">
            </div>
            <button onclick="lanjutKeUpah()" class="w-full btn-primary mt-4 bg-orange-500 shadow-xl shadow-orange-500/30">Mulai Input Riwayat</button>
        </div>
    </div>

    <div id="page-wiz-2" class="page">
        <div class="p-6 bg-white border-b flex justify-between items-center">
            <h2 id="label-tahun-jalan" class="font-black text-blue-900 uppercase tracking-widest text-sm">TAHUN 2024</h2>
            <div class="flex gap-2">
                <button onclick="duplikatGajiPintar()" class="text-[10px] font-bold bg-blue-50 text-blue-700 px-3 py-1 rounded-lg border border-blue-200">DUPLIKAT</button>
            </div>
        </div>
        <div class="scroll-area space-y-3" id="container-input-bulan"></div>
        
        <div class="p-4 bg-white border-t space-y-3 shadow-[0_-10px_20px_rgba(0,0,0,0.05)]">
            <div class="grid grid-cols-2 gap-3">
                <div class="p-3 bg-gray-50 rounded-xl border">
                    <label class="text-[8px] font-black text-gray-400 uppercase block">THR Diterima</label>
                    <input type="text" id="thr-tahunan" oninput="handleCurrency(event)" placeholder="Rp 0" class="w-full bg-transparent font-bold text-blue-900 outline-none">
                </div>
                <div class="p-3 bg-gray-50 rounded-xl border">
                    <label class="text-[8px] font-black text-gray-400 uppercase block">Kompensasi</label>
                    <input type="text" id="komp-tahunan" oninput="handleCurrency(event)" placeholder="Rp 0" class="w-full bg-transparent font-bold text-green-700 outline-none">
                </div>
            </div>
            <button onclick="prosesTahunBerikutnya()" id="btn-next-tahun" class="w-full btn-primary">SIMPAN & LANJUT</button>
        </div>
    </div>

    <div id="page-wiz-3" class="page items-center p-8">
        <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center text-5xl mb-6">üè¢</div>
        <h2 class="text-xl font-black text-blue-900 text-center leading-tight mb-2">UMP SAAT PHK</h2>
        <p class="text-xs text-center text-gray-400 font-medium mb-8">Berapa UMP Bitung/Sulut pada tahun <span id="thn-phk-label" class="font-black text-orange-500"></span>?</p>
        
        <input type="text" id="ump-terakhir" oninput="handleCurrency(event)" placeholder="Rp 0" class="w-full p-6 glass-card text-center text-3xl font-black text-blue-900 outline-none border-2 border-orange-200 mb-8">
        
        <button onclick="hitungHasilFinal()" class="w-full btn-primary bg-green-600 shadow-xl shadow-green-600/30">LIHAT HASIL PERHITUNGAN</button>
        <button onclick="navigasi('page-wiz-2')" class="mt-4 text-xs font-bold text-gray-400 uppercase">Kembali Edit Data</button>
    </div>

    <div id="page-hasil" class="page">
        <div class="no-print p-6 bg-blue-900 text-white flex justify-between items-center shadow-lg">
            <button onclick="navigasi('page-dashboard')" class="text-xs font-bold bg-white/10 px-4 py-2 rounded-xl">DASHBOARD</button>
            <h2 class="font-black italic tracking-tighter">mySBSI HASIL</h2>
            <button onclick="logout()" class="text-xs font-bold bg-red-500 px-4 py-2 rounded-xl">LOGOUT</button>
        </div>

        <div class="scroll-area">
            <div class="hidden print:block text-center border-b-4 border-double border-blue-900 pb-4 mb-6">
                <h1 class="text-2xl font-black text-blue-900">SBSI KOTA BITUNG</h1>
                <p class="text-[10px] font-bold uppercase tracking-[4px]">Laporan Perhitungan Hak Buruh</p>
            </div>

            <div class="glass-card p-6 bg-gradient-to-br from-blue-900 to-blue-800 text-white mb-6">
                <p class="text-[10px] font-bold opacity-60 uppercase tracking-widest">Total Hak Anda (Estimasi)</p>
                <h2 id="res-total" class="text-4xl font-black text-orange-400 mt-2">Rp 0</h2>
            </div>

            <div class="space-y-4 mb-10">
                <div class="glass-card p-5 flex justify-between items-center border-l-8 border-blue-900">
                    <span class="text-[10px] font-black text-gray-400 uppercase">Pesangon & UMPK</span>
                    <span id="res-pesangon" class="font-black text-blue-900">Rp 0</span>
                </div>
                <div class="glass-card p-5 flex justify-between items-center border-l-8 border-orange-500">
                    <span class="text-[10px] font-black text-gray-400 uppercase">Selisih Gaji & THR</span>
                    <span id="res-selisih" class="font-black text-orange-700">Rp 0</span>
                </div>
                <div class="p-4 bg-blue-50 rounded-2xl border border-blue-100">
                    <p class="text-[10px] font-bold text-blue-900 italic">"Gunakan laporan ini sebagai dasar perundingan Bipartit dengan perusahaan."</p>
                </div>
            </div>

            <div class="no-print space-y-3">
                <button onclick="window.print()" class="w-full p-4 rounded-2xl bg-white border-2 border-blue-900 text-blue-900 font-black uppercase text-xs">Cetak / Simpan PDF</button>
            </div>
        </div>
    </div>

    <script>
        // MASUKKAN URL GOOGLE APPS SCRIPT BAPAK DI SINI
        const URL_GAS = "https://script.google.com/macros/s/AKfycbxC8-ak4mSC-Qm8UCb2c5RHs3LjHS5xHbhccquuWc5b6ybHUdX-A8M9-Of13ajOb_Om/exec";

        let tahunList = [], indexTahunSekarang = 0, databaseUpah = {}, dataTunjangan = {}, tglMasuk, tglPhk;

        function showNotif(msg) {
            const box = document.getElementById('custom-alert');
            document.getElementById('alert-msg').innerText = msg;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 3000);
        }

        function navigasi(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function handleCurrency(e) {
            let val = e.target.value.replace(/[^0-9]/g, '');
            if(!val) { e.target.value = ""; return; }
            e.target.value = "Rp " + new Intl.NumberFormat('id-ID').format(val);
        }

        function formatIDR(val) {
            return "Rp " + new Intl.NumberFormat('id-ID').format(val);
        }

        async function prosesLogin() {
            const nik = document.getElementById('nik').value;
            const pass = document.getElementById('pass').value;
            if(!nik || !pass) return showNotif("Isi NIK & Password!");
            // Simulasi Login (Hubungkan ke GAS Bapak)
            showNotif("Menghubungkan ke Server...");
            navigasi('page-dashboard');
        }

        function logout() { localStorage.removeItem("session_sbsi"); location.reload(); }

        function lanjutKeUpah() {
            const m = document.getElementById('tgl-masuk').value;
            const p = document.getElementById('tgl-phk').value;
            if(!m || !p) return showNotif("Pilih Tanggal!");
            tglMasuk = new Date(m); tglPhk = new Date(p);
            tahunList = [];
            for(let t = tglMasuk.getFullYear(); t <= tglPhk.getFullYear(); t++) tahunList.push(t);
            indexTahunSekarang = 0;
            renderFormTahun();
        }

        function renderFormTahun() {
            const thn = tahunList[indexTahunSekarang];
            document.getElementById('label-tahun-jalan').innerText = "TAHUN " + thn;
            
            // Load THR/Komp jika sudah ada
            document.getElementById('thr-tahunan').value = dataTunjangan[thn]?.thr ? formatIDR(dataTunjangan[thn].thr) : "";
            document.getElementById('komp-tahunan').value = dataTunjangan[thn]?.komp ? formatIDR(dataTunjangan[thn].komp) : "";

            const blnNama = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
            let html = "";
            let mStart = (thn === tglMasuk.getFullYear()) ? tglMasuk.getMonth() : 0;
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;

            for(let i = mStart; i <= mEnd; i++) {
                const val = databaseUpah[`${thn}-${i+1}`] || "";
                html += `
                <div class="glass-card p-4 flex items-center justify-between border-gray-100">
                    <span class="text-[10px] font-black text-gray-400 uppercase">${blnNama[i]}</span>
                    <input type="text" id="inp-${i+1}" value="${val ? formatIDR(val) : ''}" 
                           oninput="saveUpah(event, ${i+1})" placeholder="Rp 0" class="w-32 text-right font-black text-blue-900 outline-none bg-transparent">
                </div>`;
            }
            document.getElementById('container-input-bulan').innerHTML = html;
            document.getElementById('btn-next-tahun').innerText = (indexTahunSekarang === tahunList.length - 1) ? "LANJUT KE UMP" : "LANJUT KE TAHUN " + (thn+1);
            navigasi('page-wiz-2');
        }

        function saveUpah(e, bln) {
            handleCurrency(e);
            databaseUpah[`${tahunList[indexTahunSekarang]}-${bln}`] = e.target.value.replace(/[^0-9]/g, '');
        }

        function duplikatGajiPintar() {
            const thn = tahunList[indexTahunSekarang];
            let gTerakhir = "";
            for(let i=1; i<=12; i++) { if(databaseUpah[`${thn}-${i}`]) gTerakhir = databaseUpah[`${thn}-${i}`]; }
            if(!gTerakhir) return showNotif("Isi gaji satu bulan dulu!");
            let mEnd = (thn === tglPhk.getFullYear()) ? tglPhk.getMonth() : 11;
            for(let i=1; i<=mEnd+1; i++) {
                databaseUpah[`${thn}-${i}`] = gTerakhir;
                const el = document.getElementById('inp-'+i);
                if(el) el.value = formatIDR(gTerakhir);
            }
        }

        function prosesTahunBerikutnya() {
            const thn = tahunList[indexTahunSekarang];
            dataTunjangan[thn] = {
                thr: document.getElementById('thr-tahunan').value.replace(/[^0-9]/g, ''),
                komp: document.getElementById('komp-tahunan').value.replace(/[^0-9]/g, '')
            };
            if(indexTahunSekarang < tahunList.length - 1) { indexTahunSekarang++; renderFormTahun(); }
            else { 
                document.getElementById('thn-phk-label').innerText = tglPhk.getFullYear();
                navigasi('page-wiz-3'); 
            }
        }

        function hitungHasilFinal() {
            const ump = document.getElementById('ump-terakhir').value.replace(/[^0-9]/g, '');
            if(!ump) return showNotif("Input UMP Terakhir!");
            
            // LOGIKA HITUNG SIMULASI
            const hPesangon = parseInt(ump) * 9.5; 
            const hSelisih = 4250000;
            
            document.getElementById('res-pesangon').innerText = formatIDR(hPesangon);
            document.getElementById('res-selisih').innerText = formatIDR(hSelisih);
            document.getElementById('res-total').innerText = formatIDR(hPesangon + hSelisih);
            navigasi('page-hasil');
        }
    </script>
</body>
</html>
